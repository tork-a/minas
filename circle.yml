general:
  artifacts:
    - "$CIRCLE_ARTIFACTS/"
machine:
  environment:
    PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin  # disable circle ci virtual env...
    ROS_DISTRO: indigo
    ROS_REPOSITORY_PATH: http://packages.ros.org/ros/ubuntu
dependencies:
  pre:
    - env | grep ROS
    #- sudo rm /etc/apt/sources.list.d/*
    - sudo sh -c "echo \"deb $ROS_REPOSITORY_PATH `lsb_release -cs` main\" > /etc/apt/sources.list.d/ros-latest.list"
    - wget http://packages.ros.org/ros.key -O - | sudo apt-key add -
    - sudo apt-get update
    - sudo apt-get install -y -q python-catkin-pkg python-rosdep ros-$ROS_DISTRO-catkin
    - sudo apt-get install -y -q mongodb # to install ros-indigo-warehouse-ros
    - sudo rosdep init && rosdep update
  override:
    - mkdir -p ~/catkin_ws/src
    - cd ~/catkin_ws/src && ln -sf ~/$CIRCLE_PROJECT_REPONAME $CIRCLE_PROJECT_REPONAME
test:
  override:
    - . /opt/ros/$ROS_DISTRO/setup.bash && cd ~/catkin_ws && rosdep install --from-paths src/ --ignore-src -y 
    - . /opt/ros/$ROS_DISTRO/setup.bash && cd ~/catkin_ws && catkin_make

